<!doctype html>

<html
  lang="en"
  class="light-style layout-navbar-fixed layout-menu-fixed layout-compact"
  dir="ltr"
  data-theme="theme-bordered"
  data-assets-path="assets/"
  data-template="vertical-menu-template-bordered"
  data-style="light">
  <head>
    <script src="js/ruta-protegida.js?v=1.3343"></script>
    <title>Propiedades</title>
    <meta name="description" content="Billetera" />

    <script src="js/head.js?v=1.3343"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap"
      rel="stylesheet" />

    <!-- Icons -->
    <link rel="stylesheet" href="../../assets/vendor/fonts/fontawesome.css?v=1.3343" />
    <link rel="stylesheet" href="../../assets/vendor/fonts/tabler-icons.css?v=1.3343" />
    <link rel="stylesheet" href="../../assets/vendor/fonts/flag-icons.css?v=1.3343" />

    <!-- Core CSS -->

    <link rel="stylesheet" href="../../assets/vendor/css/rtl/core.css?v=1.3343" class="template-customizer-core-css" />
    <link rel="stylesheet" href="assets/vendor/css/rtl/theme-bordered.css?v=1.3343" />

    <link rel="stylesheet" href="../../assets/css/demo.css?v=1.3343" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../../assets/vendor/libs/node-waves/node-waves.css?v=1.3343" />

    <link rel="stylesheet" href="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css?v=1.3343" />
    <link rel="stylesheet" href="../../assets/vendor/libs/typeahead-js/typeahead.css?v=1.3343" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css?v=1.3343" />
    <link rel="stylesheet" href="../../assets/vendor/libs/animate-css/animate.css?v=1.3343" />
    <link rel="stylesheet" href="../../assets/vendor/libs/sweetalert2/sweetalert2.css?v=1.3343" />


    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../../assets/vendor/js/helpers.js?v=1.3343"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->

    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../../assets/js/config.js?v=1.3343"></script>

    <style>
      .dt-search,.dt-info{
        padding:0 16px;
      }
    </style>
    <style>
      /* Hacemos la columna de acciones sticky */
      .sticky-col {
        position: -webkit-sticky; /* para compatibilidad con Safari */
        position: sticky;
        right: 0;
        background-color: white;
        z-index: 1; /* Para asegurarnos que quede por encima de las otras columnas */
        border-left: 1px solid #eee;
      }
      .sticky-col::before{
        content: '';
        width: 1px;
        background-color: #eee;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
      }
    </style>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <span class="app-brand-text demo menu-text fw-bold">Quality Mountain</span>
        
            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
              
              <i class="ti ti-x d-block d-xl-none ti-md align-middle"></i>
            </a>
          </div>
          <div class="menu-inner-shadow"></div>
          <ul class="menu-inner py-1" id="links-menu">

          </ul>
        </aside>
        <script>
          // Cargar el navbar desde el archivo HTML
          fetch('componentes/menu.html')
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              return response.text();
            })
            .then(data => {
              document.getElementById('links-menu').innerHTML = data; // Insertar el contenido en el contenedor
              document.getElementById('item-propiedades').classList.add('active');
            })
            .catch(error => console.error('Error loading the navbar:', error));
        </script>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page ">


          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y pt-0">

              <!-- End Offcanvas -->
              <div class="row mb-5">
                <div class="col-12">
                  <button
                    class="btn btn-primary"
                    type="button"
                    data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasEnd"
                    aria-controls="offcanvasEnd">
                    Agregar Nueva Propiedad
                  </button>
                  <div
                    class="offcanvas offcanvas-end"
                    tabindex="-1"
                    id="offcanvasEnd"
                    aria-labelledby="offcanvasEndLabel">
                    <div class="offcanvas-header">
                      <h5 id="offcanvasEndLabel" class="offcanvas-title">Offcanvas End</h5>
                      <button
                        type="button"
                        class="btn-close text-reset"
                        data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body my-auto mx-0 flex-grow-0">
                      <p class="text-center">
                        Lorem ipsum, or lipsum as it is sometimes known, is dummy text used in laying out print,
                        graphic or web designs. The passage is attributed to an unknown typesetter in the 15th
                        century who is thought to have scrambled parts of Cicero's De Finibus Bonorum et Malorum
                        for use in a type specimen book.
                      </p>
                      <button type="button" class="btn btn-primary mb-2 d-grid w-100">Continue</button>
                      <button
                        type="button"
                        class="btn btn-label-secondary d-grid w-100"
                        data-bs-dismiss="offcanvas">
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-12">
                  <div class="card">
                    <div class="table-responsive text-nowrap">
                      <table id="miTabla" class="display">
                        <thead>
                          <tr>
                            <th>Owner</th>
                            <th>Property Code</th>
                            <th>Type Of Property</th>
                            <th>Physical Address</th>
                            <th>Acciones</th>
                          </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                      </table>
                    </div>
                    
                  </div>
                </div>
              </div>
              
              
              
            </div>
            <!-- / Content -->

            <!-- Footer -->
            <footer 
              class="content-footer footer bg-footer-theme"
              id="footer">
            </footer>
            <script>
              // Cargar el navbar desde el archivo HTML
              fetch('componentes/footer.html')
                .then(response => {
                  if (!response.ok) {
                    throw new Error('Network response was not ok');
                  }
                  return response.text();
                })
                .then(data => {
                  document.getElementById('footer').innerHTML = data; // Insertar el contenido en el contenedor
                })
                .catch(error => console.error('Error loading the navbar:', error));
            </script>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->

    <script src="../../assets/vendor/libs/jquery/jquery.js?v=1.3343"></script>
    <script src="../../assets/vendor/libs/popper/popper.js?v=1.3343"></script>
    <script src="../../assets/vendor/js/bootstrap.js?v=1.3343"></script>
    <script src="../../assets/vendor/libs/node-waves/node-waves.js?v=1.3343"></script>
    <script src="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js?v=1.3343"></script>
    <script src="../../assets/vendor/libs/hammer/hammer.js?v=1.3343"></script>
    <script src="../../assets/vendor/libs/i18n/i18n.js?v=1.3343"></script>
    <script src="../../assets/vendor/libs/typeahead-js/typeahead.js?v=1.3343"></script>
    <script src="../../assets/vendor/js/menu.js?v=1.3343"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js?v=1.3343"></script>
    <script src="../../assets/vendor/libs/sweetalert2/sweetalert2.js?v=1.3343"></script>

    <!-- Main JS -->
    <script src="../../assets/js/main.js?v=1.3343"></script>

    <!-- Page JS -->

    <script src="../../assets/js/extended-ui-sweetalert2.js?v=1.3343"></script>
    
    <script>
      const accessToken = localStorage.getItem('access_token');

      $(document).ready(function() {
        const table = $('#miTabla').DataTable({
          "ajax": {
            "url": "https://back.dashboard.chatbot.mosquedacordova.com/api/property", // Ruta del archivo JSON
            "type": "GET", // Método HTTP
            "headers": {
                'Authorization': `Bearer ${accessToken}`, // Agregar encabezado de autorización
                'Content-Type': 'application/json' // Tipo de contenido
            },
            "data": function(d) {
              // Aquí puedes agregar más parámetros si es necesario
              // `d` contiene información sobre el estado de la tabla y puedes modificarla
            },
            "dataSrc": "data" // Cambia esto según el campo donde se encuentren los registros en la respuesta
          },
          "scrollX": true, // Habilitar el scroll horizontal
          "lengthChange": false, // Permitir cambiar el número de registros por página
          "pageLength": 10, // Número de registros por página
          "processing": true, // Habilitar el indicador de procesamiento
          "serverSide": true, // Habilitar el procesamiento del lado del servidor
          "columns": [
            { "data": "owner", "orderable": false  },
            { "data": "property_code", "orderable": false  },
            { "data": "type_of_property", "orderable": false  },
            { "data": "physical_address", "orderable": false  },
            {
              "data": null,
              "defaultContent": "<button class='btn btn-primary edit-btn' type='button' data-bs-toggle='offcanvas' data-bs-target='#offcanvasEnd' aria-controls='offcanvasEnd'>Editar</button> <button type='button' class='btn btn-primary delete-btn'>Eliminar</button>",
              "orderable": false, // Evita que esta columna se ordene
              "className": "sticky-col" // Aplicar la clase sticky a la columna de acciones
            }
          ],
          "language": {
            "url": "//cdn.datatables.net/plug-ins/1.13.1/i18n/es-ES.json"
          }
        });

        // Manejo de eventos para el botón de editar
        $('#miTabla tbody').on('click', '.edit-btn', function() {
          const data = table.row($(this).parents('tr')).data();
          alert('Editando: ' + data.nombre);
        });

        // Manejo de eventos para el botón de eliminar
        $('#miTabla tbody').on('click', '.delete-btn', function() {
          const row = $(this).parents('tr'); // Guardar la referencia a la fila
          const data = table.row(row).data(); // Obtener los datos de la fila
          
          Swal.fire({
            title: '¡No podrás revertir esto!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: '¡Lo sé, eliminalo!',
            cancelButtonText: 'Cancelar',
            customClass: {
              confirmButton: 'btn btn-primary me-3 waves-effect waves-light',
              cancelButton: 'btn btn-label-secondary waves-effect waves-light'
            },
            buttonsStyling: false
          }).then(function (result) {
            if (result.isConfirmed) {
              // Aquí puedes mostrar un mensaje de éxito antes de eliminar la fila
              Swal.fire({
                icon: 'success',
                title: '¡Eliminado!',
                customClass: {
                  confirmButton: 'btn btn-success waves-effect waves-light'
                }
              });

              // Eliminar la fila
              table.row(row).remove().draw();
            }
          });
          
        });

        // Ocultar paginación si no hay suficientes filas
        table.on('draw', function() {
          const rowCount = table.data().count();
          const paginationControl = $('#miTabla_wrapper .dt-paging');
          const infoControl = $('#miTabla_wrapper .dt-info');
          
          if (rowCount <= 2) { // Cambia el número 10 al número de filas mínimo que desees
            paginationControl.hide();
            infoControl.hide();
          } else {
            paginationControl.show();
            infoControl.show();
          }
        });
        
      });
    </script>

  </body>
</html>
